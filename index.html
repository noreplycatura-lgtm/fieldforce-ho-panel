<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HO Admin Panel - Field Rep App</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('SW registered:', registration.scope);
                        
                        // Request periodic sync (if supported)
                        if ('periodicSync' in registration) {
                            registration.periodicSync.register('sync-data-periodic', {
                                minInterval: 15 * 60 * 1000 // 15 minutes
                            }).catch(err => console.log('Periodic sync not available'));
                        }
                    })
                    .catch((error) => {
                        console.log('SW registration failed:', error);
                    });
                
                // Listen for sync complete messages
                navigator.serviceWorker.addEventListener('message', (event) => {
                    if (event.data && event.data.type === 'SYNC_COMPLETE') {
                        console.log('Background sync completed:', event.data.timestamp);
                        showToast('Data synced successfully', 'success');
                        // Refresh current page data
                        if (typeof refreshCurrentPage === 'function') {
                            refreshCurrentPage();
                        }
                    }
                });
            });
        }
    </script>

    <script src="js/app.js"></script>
</body>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-box">
                <div class="login-header">
                    <i class="fas fa-building"></i>
                    <h1>HO Admin Panel</h1>
                    <p>Field Representative Management System</p>
                </div>
                <form id="loginForm">
                    <div class="form-group">
                        <label>User Code</label>
                        <input type="text" id="userCode" placeholder="Enter User Code" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="password" placeholder="Enter Password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>
                <div id="loginError" class="error-msg hidden"></div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-building"></i>
                <span>HO Panel</span>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </li>
                <li class="nav-item" data-page="employees">
                    <i class="fas fa-users"></i>
                    <span>Employees</span>
                </li>
                <li class="nav-item" data-page="customers">
                    <i class="fas fa-user-tie"></i>
                    <span>Customers</span>
                </li>
                <li class="nav-item" data-page="stockists">
                    <i class="fas fa-store"></i>
                    <span>Stockists</span>
                </li>
                <li class="nav-item" data-page="products">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </li>
                <li class="nav-item" data-page="areas">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Areas</span>
                </li>
                <li class="nav-item" data-page="expenses">
                    <i class="fas fa-receipt"></i>
                    <span>Expenses</span>
                </li>
                <li class="nav-item" data-page="hierarchy">
                    <i class="fas fa-sitemap"></i>
                    <span>Hierarchy</span>
                </li>
                <li class="nav-item" data-page="announcements">
                    <i class="fas fa-bullhorn"></i>
                    <span>Announcements</span>
                </li>
                <li class="nav-item" data-page="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </li>
                <li class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </li>
            </ul>
            <div class="sidebar-footer">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="currentUserName">Admin</span>
                </div>
                <button class="btn-logout" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 id="pageTitle">Dashboard</h2>
                </div>
                <div class="header-right">
                    <span class="date-time" id="dateTime"></span>
                    <button class="btn-icon" id="refreshBtn" title="Refresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </header>

            <!-- Dashboard Page -->
            <section id="dashboardPage" class="content-page active">
                <div class="stats-grid">
                    <div class="stat-card blue">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="statEmployees">0</span>
                            <span class="stat-label">Active Employees</span>
                        </div>
                    </div>
                    <div class="stat-card green">
                        <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="statTodayPunches">0</span>
                            <span class="stat-label">Today's Punches</span>
                        </div>
                    </div>
                    <div class="stat-card purple">
                        <div class="stat-icon"><i class="fas fa-map-marker-alt"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="statTodayVisits">0</span>
                            <span class="stat-label">Today's Visits</span>
                        </div>
                    </div>
                    <div class="stat-card orange">
                        <div class="stat-icon"><i class="fas fa-rupee-sign"></i></div>
                        <div class="stat-info">
                            <span class="stat-value" id="statTodayPOB">₹0</span>
                            <span class="stat-label">Today's POB</span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <!-- Pending Approvals -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-clock"></i> Pending Approvals</h3>
                        </div>
                        <div class="card-body">
                            <div class="pending-item" onclick="navigateTo('customers')">
                                <span class="pending-label">Customer Approvals</span>
                                <span class="pending-count" id="pendingCustomers">0</span>
                            </div>
                            <div class="pending-item" onclick="navigateTo('expenses')">
                                <span class="pending-label">Expense Approvals</span>
                                <span class="pending-count" id="pendingExpenses">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-history"></i> Recent Visits</h3>
                        </div>
                        <div class="card-body">
                            <div class="activity-list" id="recentVisitsList">
                                <p class="text-muted">Loading...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats Chart -->
                    <div class="card full-width">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> This Month Performance</h3>
                        </div>
                        <div class="card-body">
                            <div class="performance-bars" id="performanceBars">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Employees Page -->
            <section id="employeesPage" class="content-page">
                <div class="page-actions">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="empSearch" placeholder="Search employees...">
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="openBulkUploadModal('employees')">
                            <i class="fas fa-upload"></i> Bulk Upload
                        </button>
                        <button class="btn btn-primary" onclick="openEmployeeModal()">
                            <i class="fas fa-plus"></i> Add Employee
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table" id="employeesTable">
                        <thead>
                            <tr>
                                <th>Emp ID</th>
                                <th>Name</th>
                                <th>Mobile</th>
                                <th>Designation</th>
                                <th>Reporting To</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="employeesTableBody">
                            <tr><td colspan="7" class="text-center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Customers Page -->
            <section id="customersPage" class="content-page">
                <div class="tabs">
                    <button class="tab active" data-tab="pendingCustomers">Pending Approval</button>
                    <button class="tab" data-tab="allCustomers">All Customers</button>
                    <button class="tab" data-tab="transferCustomers">Transfer</button>
                </div>

                <!-- Pending Customers Tab -->
                <div id="pendingCustomersTab" class="tab-content active">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Customer Name</th>
                                    <th>Specialty</th>
                                    <th>Area</th>
                                    <th>Mobile</th>
                                    <th>Added By</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingCustomersBody">
                                <tr><td colspan="7" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- All Customers Tab -->
<div id="allCustomersTab" class="tab-content">
    <div class="page-actions">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="custSearch" placeholder="Search customers..." oninput="filterCustomers()">
        </div>
        <div class="filter-group">
            <select id="custStatusFilter" onchange="filterCustomers()">
                <option value="all">All Status</option>
                <option value="Approved">Approved</option>
                <option value="Pending">Pending</option>
                <option value="Rejected">Rejected</option>
            </select>
        </div>
    </div>
    
    <!-- Transfer Section -->
    <div class="transfer-action-bar">
        <div class="transfer-info">
            <span>Selected: <strong id="selectedCustomerCount">0</strong> customer(s)</span>
        </div>
        <div class="transfer-controls">
            <select id="transferTargetEmp">
                <option value="">-- Transfer To --</option>
            </select>
            <button class="btn btn-primary btn-sm" onclick="transferSelectedCustomers()">
                <i class="fas fa-exchange-alt"></i> Transfer Selected
            </button>
        </div>
    </div>
    
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th style="width: 40px;">
                        <input type="checkbox" id="selectAllCust" onchange="selectAllCustomers(this)">
                    </th>
                    <th>Code</th>
                    <th>Customer Name</th>
                    <th>Specialty</th>
                    <th>Area</th>
                    <th>City</th>
                    <th>Mobile</th>
                    <th>Status</th>
                    <th>Created By</th>
                </tr>
            </thead>
            <tbody id="allCustomersBody">
                <tr><td colspan="9" class="text-center">Loading...</td></tr>
            </tbody>
        </table>
    </div>
</div>

                <!-- Transfer Customers Tab -->
<div id="transferCustomersTab" class="tab-content">
    <div class="transfer-container">
        
        <!-- Excel Template Method -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-file-excel"></i> Transfer by Excel Template</h3>
            </div>
            <div class="card-body">
                
                <!-- Step 1 -->
                <div style="display: flex; gap: 16px; margin-bottom: 20px; align-items: flex-end; flex-wrap: wrap;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Select Employee</label>
                        <select id="downloadEmpSelect" onchange="updateCustomerCount()" style="min-width: 200px;">
                            <option value="">-- Select Employee --</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label>Customers</label>
                        <input type="text" id="empCustomerCount" value="0" readonly style="width: 80px; text-align: center; font-weight: bold;">
                    </div>
                    <button class="btn btn-success" onclick="downloadCustomerTemplate()">
                        <i class="fas fa-download"></i> Download Template
                    </button>
                </div>

                <!-- Instructions -->
                <div style="background: #f8f9fa; padding: 14px; border-radius: 6px; margin-bottom: 20px;">
                    <p style="font-size: 12px; margin-bottom: 8px;"><strong>How to use:</strong></p>
                    <ol style="font-size: 11px; margin-left: 16px; color: #666;">
                        <li>Select employee and download template</li>
                        <li>Open CSV file in Excel</li>
                        <li>Fill <strong>new_emp_id</strong> column with target employee code</li>
                        <li>Leave blank to skip that customer</li>
                        <li>Save and upload below</li>
                    </ol>
                </div>

                <!-- Upload -->
                <div class="form-group">
                    <label>Upload Updated File</label>
                    <input type="file" id="transferUploadFile" accept=".csv" onchange="previewTransferFile()">
                </div>
                
                <div id="transferPreview" class="hidden" style="background: #f8f9fa; padding: 14px; border-radius: 6px; margin: 14px 0; max-height: 200px; overflow: auto;"></div>
                
                <button class="btn btn-primary" onclick="processTransferUpload()" id="uploadTransferBtn" disabled>
                    <i class="fas fa-upload"></i> Upload & Transfer
                </button>
                
            </div>
        </div>

        <!-- Quick Manual Transfer -->
        <div class="card" style="margin-top: 20px;">
            <div class="card-header">
                <h3><i class="fas fa-exchange-alt"></i> Quick Manual Transfer</h3>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>From Employee</label>
                        <select id="transferFromEmp" onchange="loadTransferCustomers()"></select>
                    </div>
                    <div class="form-group">
                        <label>To Employee</label>
                        <select id="transferToEmp"></select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Select Customers</label>
                    <div class="checkbox-list" id="transferCustomersList" style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 6px; padding: 10px;">
                        <p class="text-muted">Select "From Employee" first</p>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="bulkTransferCustomers()">
                    <i class="fas fa-exchange-alt"></i> Transfer Selected
                </button>
            </div>
        </div>

        <!-- Employee Reference -->
        <div class="card" style="margin-top: 20px;">
            <div class="card-header">
                <h3><i class="fas fa-users"></i> Employee Codes Reference</h3>
            </div>
            <div class="card-body">
                <button class="btn btn-secondary btn-sm" onclick="downloadEmployeeList()" style="margin-bottom: 10px;">
                    <i class="fas fa-download"></i> Download Employee List
                </button>
                <div class="table-container" style="max-height: 200px; overflow-y: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Emp ID</th>
                                <th>Name</th>
                                <th>Designation</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="empReferenceBody">
                            <tr><td colspan="4" class="text-center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>
</section>

            <!-- Stockists Page -->
            <section id="stockistsPage" class="content-page">
                <div class="page-actions">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="stockSearch" placeholder="Search stockists...">
                    </div>
                    <button class="btn btn-primary" onclick="openStockistModal()">
                        <i class="fas fa-plus"></i> Add Stockist
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Stockist Name</th>
                                <th>City</th>
                                <th>Mobile</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="stockistsTableBody">
                            <tr><td colspan="6" class="text-center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Products Page -->
            <section id="productsPage" class="content-page">
                <div class="page-actions">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="prodSearch" placeholder="Search products...">
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="openBulkUploadModal('products')">
                            <i class="fas fa-upload"></i> Bulk Upload
                        </button>
                        <button class="btn btn-primary" onclick="openProductModal()">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Product Name</th>
                                <th>Category</th>
                                <th>MRP</th>
                                <th>PTS</th>
                                <th>PTR</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <tr><td colspan="8" class="text-center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Areas Page -->
            <section id="areasPage" class="content-page">
                <div class="page-actions">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="areaSearch" placeholder="Search areas...">
                    </div>
                    <button class="btn btn-primary" onclick="openAreaModal()">
                        <i class="fas fa-plus"></i> Add Area
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Area ID</th>
                                <th>Area Name</th>
                                <th>City</th>
                                <th>State</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="areasTableBody">
                            <tr><td colspan="6" class="text-center">Loading...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Expenses Page -->
            <section id="expensesPage" class="content-page">
                <div class="tabs">
                    <button class="tab active" data-tab="pendingExpenses">Pending Approval</button>
                    <button class="tab" data-tab="allExpenses">All Expenses</button>
                </div>

                <!-- Pending Expenses Tab -->
                <div id="pendingExpensesTab" class="tab-content active">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Designation</th>
                                    <th>Month</th>
                                    <th>Daily Total</th>
                                    <th>Fixed Total</th>
                                    <th>Grand Total</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingExpensesBody">
                                <tr><td colspan="7" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- All Expenses Tab -->
                <div id="allExpensesTab" class="tab-content">
                    <div class="page-actions">
                        <div class="filter-group">
                            <select id="expMonthFilter">
                                <option value="">Select Month</option>
                            </select>
                            <select id="expStatusFilter">
                                <option value="all">All Status</option>
                                <option value="Submitted">Submitted</option>
                                <option value="Approved">Approved</option>
                                <option value="Rejected">Rejected</option>
                                <option value="Countered">Countered</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Employee</th>
                                    <th>Month</th>
                                    <th>Daily Total</th>
                                    <th>Fixed Total</th>
                                    <th>Grand Total</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="allExpensesBody">
                                <tr><td colspan="7" class="text-center">Loading...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Hierarchy Page -->
            <section id="hierarchyPage" class="content-page">
                <div class="tabs">
                    <button class="tab active" data-tab="hierarchyView">Hierarchy View</button>
                    <button class="tab" data-tab="areaMapping">Area Mapping</button>
                </div>

                <!-- Hierarchy View Tab -->
                <div id="hierarchyViewTab" class="tab-content active">
                    <div class="hierarchy-container" id="hierarchyTree">
                        <p class="text-muted">Loading hierarchy...</p>
                    </div>
                </div>

                <!-- Area Mapping Tab -->
                <div id="areaMappingTab" class="tab-content">
                    <div class="mapping-container">
                        <div class="form-group">
                            <label>Select Employee</label>
                            <select id="mappingEmployee" onchange="loadEmployeeAreas()"></select>
                        </div>
                        <div class="form-group">
                            <label>Assigned Areas</label>
                            <div class="checkbox-list" id="mappingAreasList">
                                <p class="text-muted">Select employee first</p>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveAreaMapping()">
                            <i class="fas fa-save"></i> Save Mapping
                        </button>
                    </div>
                </div>
            </section>

            <!-- Announcements Page -->
            <section id="announcementsPage" class="content-page">
                <div class="page-actions">
                    <button class="btn btn-primary" onclick="openAnnouncementModal()">
                        <i class="fas fa-plus"></i> New Announcement
                    </button>
                </div>
                <div class="announcements-list" id="announcementsList">
                    <p class="text-muted">Loading...</p>
                </div>
            </section>

            <!-- Reports Page -->
            <section id="reportsPage" class="content-page">
                <div class="report-filters">
                    <div class="form-group">
                        <label>Report Type</label>
                        <select id="reportType">
                            <option value="daily_summary">Daily Summary</option>
                            <option value="employee_performance">Employee Performance</option>
                            <option value="area_wise">Area Wise</option>
                            <option value="product_wise">Product Wise</option>
                            <option value="stockist_wise">Stockist Wise</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" id="reportStartDate">
                    </div>
                    <div class="form-group">
                        <label>End Date</label>
                        <input type="date" id="reportEndDate">
                    </div>
                    <button class="btn btn-primary" onclick="generateReport()">
                        <i class="fas fa-chart-bar"></i> Generate Report
                    </button>
                    <button class="btn btn-secondary" onclick="exportReport('excel')">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportReport('pdf')">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                </div>
                <div class="report-content" id="reportContent">
                    <p class="text-muted text-center">Select filters and generate report</p>
                </div>
            </section>

            <!-- Settings Page -->
            <section id="settingsPage" class="content-page">
                <div class="settings-container">
                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-sliders-h"></i> App Settings</h3>
                        </div>
                        <div class="card-body">
                            <div class="settings-form" id="settingsForm">
                                <div class="form-group">
                                    <label>Default Radius (meters)</label>
                                    <input type="number" id="setting_default_radius" value="300">
                                </div>
                                <div class="form-group">
                                    <label>Max Radius (meters)</label>
                                    <input type="number" id="setting_max_radius" value="500">
                                </div>
                                <div class="form-group">
                                    <label>HQ Allowance (₹)</label>
                                    <input type="number" id="setting_hq_allowance" value="200">
                                </div>
                                <div class="form-group">
                                    <label>Ex-HQ Allowance (₹)</label>
                                    <input type="number" id="setting_ex_hq_allowance" value="400">
                                </div>
                                <div class="form-group">
                                    <label>Outstation Allowance (₹)</label>
                                    <input type="number" id="setting_outstation_allowance" value="800">
                                </div>
                                <div class="form-group">
                                    <label>KM Rate (₹/km)</label>
                                    <input type="number" id="setting_km_rate" value="5">
                                </div>
                                <div class="form-group">
                                    <label>Mobile Allowance (₹/month)</label>
                                    <input type="number" id="setting_mobile_allowance" value="500">
                                </div>
                                <div class="form-group">
                                    <label>Max Photo Size (KB)</label>
                                    <input type="number" id="setting_photo_max_size" value="100">
                                </div>
                                <button class="btn btn-primary" onclick="saveSettings()">
                                    <i class="fas fa-save"></i> Save Settings
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3><i class="fas fa-database"></i> Data Management</h3>
                        </div>
                        <div class="card-body">
                            <button class="btn btn-secondary" onclick="createBackup()">
                                <i class="fas fa-download"></i> Create Backup
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- Employee Modal -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="employeeModalTitle">Add Employee</h3>
                <button class="modal-close" onclick="closeModal('employeeModal')">&times;</button>
            </div>
            <form id="employeeForm">
                <input type="hidden" id="empId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Name *</label>
                        <input type="text" id="empName" required>
                    </div>
                    <div class="form-group">
                        <label>Mobile *</label>
                        <input type="tel" id="empMobile" pattern="[0-9]{10}" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Designation *</label>
                        <select id="empDesignation" required>
                            <option value="">Select</option>
                            <option value="SR">SR</option>
                            <option value="SO">SO</option>
                            <option value="DASM">DASM</option>
                            <option value="ASM">ASM</option>
                            <option value="SASM">SASM</option>
                            <option value="RSM">RSM</option>
                            <option value="ZM">ZM</option>
                            <option value="SM">SM</option>
                            <option value="GM">GM</option>
                            <option value="VP">VP</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Reporting To</label>
                        <select id="empReportingTo"></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="empEmail">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="text" id="empPassword" placeholder="Default: 123456">
                    </div>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <textarea id="empAddress" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Emergency Contact</label>
                    <input type="tel" id="empEmergency">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('employeeModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Stockist Modal -->
    <div id="stockistModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="stockistModalTitle">Add Stockist</h3>
                <button class="modal-close" onclick="closeModal('stockistModal')">&times;</button>
            </div>
            <form id="stockistForm">
                <input type="hidden" id="stockistId">
                <div class="form-group">
                    <label>Stockist Name *</label>
                    <input type="text" id="stockistName" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>City *</label>
                        <input type="text" id="stockistCity" required>
                    </div>
                    <div class="form-group">
                        <label>Mobile *</label>
                        <input type="tel" id="stockistMobile" pattern="[0-9]{10}" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <textarea id="stockistAddress" rows="2"></textarea>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="stockistEmail">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('stockistModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Add Product</h3>
                <button class="modal-close" onclick="closeModal('productModal')">&times;</button>
            </div>
            <form id="productForm">
                <input type="hidden" id="productId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Product Name *</label>
                        <input type="text" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label>Product Code *</label>
                        <input type="text" id="productCode" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" id="productCategory">
                    </div>
                    <div class="form-group">
                        <label>Unit</label>
                        <input type="text" id="productUnit" value="Pcs">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>MRP (₹)</label>
                        <input type="number" id="productMRP" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>PTS (₹)</label>
                        <input type="number" id="productPTS" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>PTR (₹)</label>
                        <input type="number" id="productPTR" step="0.01">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('productModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Area Modal -->
    <div id="areaModal" class="modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3 id="areaModalTitle">Add Area</h3>
                <button class="modal-close" onclick="closeModal('areaModal')">&times;</button>
            </div>
            <form id="areaForm">
                <input type="hidden" id="areaId">
                <div class="form-group">
                    <label>Area Name *</label>
                    <input type="text" id="areaName" required>
                </div>
                <div class="form-group">
                    <label>City *</label>
                    <input type="text" id="areaCity" required>
                </div>
                <div class="form-group">
                    <label>State *</label>
                    <input type="text" id="areaState" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('areaModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Announcement Modal -->
    <div id="announcementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="announcementModalTitle">New Announcement</h3>
                <button class="modal-close" onclick="closeModal('announcementModal')">&times;</button>
            </div>
            <form id="announcementForm">
                <input type="hidden" id="announcementId">
                <div class="form-group">
                    <label>Title *</label>
                    <input type="text" id="announcementTitle" required>
                </div>
                <div class="form-group">
                    <label>Message *</label>
                    <textarea id="announcementMessage" rows="4" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Priority</label>
                        <select id="announcementPriority">
                            <option value="Normal">Normal</option>
                            <option value="Important">Important</option>
                            <option value="Urgent">Urgent</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Date *</label>
                        <input type="date" id="announcementStart" required>
                    </div>
                    <div class="form-group">
                        <label>End Date *</label>
                        <input type="date" id="announcementEnd" required>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('announcementModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Expense Detail Modal -->
    <div id="expenseDetailModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Expense Details</h3>
                <button class="modal-close" onclick="closeModal('expenseDetailModal')">&times;</button>
            </div>
            <div class="modal-body" id="expenseDetailContent">
                <p class="text-muted">Loading...</p>
            </div>
            <div class="modal-footer" id="expenseDetailActions">
                <!-- Dynamic buttons -->
            </div>
        </div>
    </div>

    <!-- Bulk Upload Modal -->
    <div id="bulkUploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="bulkUploadTitle">Bulk Upload</h3>
                <button class="modal-close" onclick="closeModal('bulkUploadModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-instructions">
                    <p>Upload CSV/Excel file with the following format:</p>
                    <div id="bulkUploadFormat" class="code-block"></div>
                    <button class="btn btn-secondary btn-sm" id="downloadTemplateBtn">
                        <i class="fas fa-download"></i> Download Template
                    </button>
                </div>
                <div class="form-group">
                    <label>Select File</label>
                    <input type="file" id="bulkUploadFile" accept=".csv,.xlsx">
                </div>
                <div id="bulkUploadPreview" class="upload-preview hidden"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('bulkUploadModal')">Cancel</button>
                <button class="btn btn-primary" onclick="processBulkUpload()">Upload</button>
            </div>
        </div>
    </div>

    <!-- Counter Expense Modal -->
    <div id="counterModal" class="modal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3>Counter Expense</h3>
                <button class="modal-close" onclick="closeModal('counterModal')">&times;</button>
            </div>
            <form id="counterForm">
                <input type="hidden" id="counterExpenseId">
                <div class="form-group">
                    <label>Original Amount</label>
                    <input type="text" id="counterOriginalAmt" readonly>
                </div>
                <div class="form-group">
                    <label>New Amount *</label>
                    <input type="number" id="counterNewAmt" step="0.01" required>
                </div>
                <div class="form-group">
                    <label>Remarks</label>
                    <textarea id="counterRemarks" rows="2"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('counterModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit Counter</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <span id="toastMessage"></span>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="spinner"></div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
